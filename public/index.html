<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sommalier Gent - Wine Agent</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="background-container">
        <img src="winery-background.png" alt="Winery Background" class="background-image">
    </div>
    
    <div class="modal-container" id="agentModal">
        <div class="modal-content">
            <!-- Agentforce Embedded Messaging Agent -->
            <div id="embedded-messaging-agent"></div>
        </div>
    </div>

    <!-- Agentforce Bootstrap Script -->
    <script type='text/javascript'>
    function initEmbeddedMessaging() {
        try {
            embeddedservice_bootstrap.settings.language = 'en_US';

            embeddedservice_bootstrap.init(
                '00DHu00000izUN6',
                'SommalierGent',
                'https://storm-11c5bf736713cf.my.site.com/ESWSommalierGent1762150331555',
                {
                    scrt2URL: 'https://storm-11c5bf736713cf.my.salesforce-scrt.com'
                }
            );

            // Wait for widget to be created, then embed it in modal and auto-open
            var checkInterval = setInterval(function() {
                var sidebar = document.querySelector('.embeddedServiceSidebar');
                var button = document.querySelector('.embeddedServiceHelpButton');
                var modalAgent = document.getElementById('embedded-messaging-agent');
                
                if (sidebar && modalAgent) {
                    clearInterval(checkInterval);
                    
                    // Move sidebar into modal
                    modalAgent.appendChild(sidebar);
                    
                    // Hide the floating button
                    if (button) {
                        button.style.display = 'none';
                    }
                    
                    // Open the chat automatically
                    setTimeout(function() {
                        // Try multiple methods to open the chat
                        var chatButton = document.querySelector('.embeddedServiceHelpButton, .embeddedServiceIcon, button[aria-label*="chat"], button[aria-label*="Chat"]');
                        if (chatButton) {
                            chatButton.click();
                        }
                        
                        // Also try to trigger the embedded service to show
                        if (window.embeddedservice_bootstrap && window.embeddedservice_bootstrap.openEmbeddedMessaging) {
                            window.embeddedservice_bootstrap.openEmbeddedMessaging();
                        }
                        
                        // Directly show the sidebar if it exists
                        if (sidebar) {
                            sidebar.style.display = 'block';
                            sidebar.style.visibility = 'visible';
                            sidebar.style.opacity = '1';
                            sidebar.classList.add('open');
                            
                            // Try to trigger any embedded service events
                            var event = new Event('embeddedservice:show');
                            document.dispatchEvent(event);
                            
                            // Also try messaging API if available
                            if (window.embeddedservice && window.embeddedservice.messaging) {
                                window.embeddedservice.messaging.show();
                            }
                        }
                    }, 500);
                }
            }, 100);
            
            // Stop checking after 10 seconds
            setTimeout(function() {
                clearInterval(checkInterval);
            }, 10000);
        } catch (err) {
            console.error('Error loading Embedded Messaging: ', err);
        }
    }
    </script>
    <script type='text/javascript' src='https://storm-11c5bf736713cf.my.site.com/ESWSommalierGent1762150331555/assets/js/bootstrap.min.js' onload='initEmbeddedMessaging()'></script>
</body>
</html>
