<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sommalier Gent - Wine Agent</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="background-container">
        <img src="winery-background.png" alt="Winery Background" class="background-image">
    </div>
    
    <div class="modal-container" id="agentModal">
        <div class="modal-content">
            <!-- Agentforce Embedded Messaging Agent -->
            <div id="embedded-messaging-agent"></div>
        </div>
    </div>

    <!-- Agentforce Bootstrap Script -->
    <script type='text/javascript'>
    var targetContainer = document.getElementById('embedded-messaging-agent');
    
    function initEmbeddedMessaging() {
        try {
            // Set target element BEFORE init
            if (targetContainer && window.embeddedservice_bootstrap) {
                embeddedservice_bootstrap.settings.targetElement = targetContainer;
            }
            
            embeddedservice_bootstrap.settings.language = 'en_US';
            
            embeddedservice_bootstrap.init(
                '00DHu00000izUN6',
                'SommalierGent_1',
                'https://storm-11c5bf736713cf.my.site.com/ESWSommalierGent1762152842517',
                {
                    scrt2URL: 'https://storm-11c5bf736713cf.my.salesforce-scrt.com'
                }
            );
        } catch (err) {
            console.error('Error loading Embedded Messaging: ', err);
        }
    }
    
    // Set target element when embedded messaging is ready (backup)
    window.addEventListener("onEmbeddedMessagingReady", function() {
        if (targetContainer && window.embeddedservice_bootstrap) {
            embeddedservice_bootstrap.settings.targetElement = targetContainer;
            
            // Auto-launch the chat immediately
            setTimeout(function() {
                if (embeddedservice_bootstrap.utilAPI && embeddedservice_bootstrap.utilAPI.launchChat) {
                    embeddedservice_bootstrap.utilAPI.launchChat();
                }
            }, 500);
        }
    });
    
    // Function to force resize agent interface to full width
    function forceResizeAgent() {
        if (!targetContainer) return;
        
        // Get modal width
        var modalWidth = targetContainer.offsetWidth || targetContainer.clientWidth;
        
        // Find all elements that might be constraining width
        var sidebar = document.querySelector('.embeddedServiceSidebar');
        var iframes = targetContainer.querySelectorAll('iframe');
        var allDivs = targetContainer.querySelectorAll('div');
        
        // Force sidebar to full width
        if (sidebar) {
            sidebar.style.width = modalWidth + 'px';
            sidebar.style.maxWidth = 'none';
            sidebar.style.minWidth = modalWidth + 'px';
        }
        
        // Force all iframes to full width
        iframes.forEach(function(iframe) {
            iframe.style.width = modalWidth + 'px';
            iframe.style.maxWidth = 'none';
            iframe.style.minWidth = modalWidth + 'px';
        });
        
        // Force all divs inside container to remove max-width constraints
        allDivs.forEach(function(div) {
            var computedStyle = window.getComputedStyle(div);
            var currentMaxWidth = computedStyle.maxWidth;
            
            // Only override if it's a pixel value (not 'none' or percentage)
            if (currentMaxWidth && currentMaxWidth !== 'none' && currentMaxWidth.includes('px')) {
                var maxWidthValue = parseInt(currentMaxWidth);
                if (maxWidthValue < modalWidth) {
                    div.style.maxWidth = 'none';
                    div.style.width = '100%';
                }
            }
        });
    }
    
    // Also try to catch and move the widget if it appears elsewhere
    var widgetChecker = setInterval(function() {
        var sidebar = document.querySelector('.embeddedServiceSidebar');
        var button = document.querySelector('.embeddedServiceHelpButton');
        
        if (sidebar && targetContainer) {
            // Check if sidebar is already in our container
            if (!targetContainer.contains(sidebar)) {
                // Move it to our container
                try {
                    sidebar.remove();
                    targetContainer.appendChild(sidebar);
                    console.log('Moved sidebar to modal container');
                } catch (err) {
                    console.error('Error moving sidebar:', err);
                }
            } else {
                // Sidebar is in container, force resize
                forceResizeAgent();
            }
        }
        
        // Hide button
        if (button) {
            button.style.display = 'none';
        }
        
        // Force resize even if sidebar is already in container
        if (sidebar && targetContainer.contains(sidebar)) {
            forceResizeAgent();
        }
    }, 200);
    
    // Also resize on window resize
    window.addEventListener('resize', function() {
        forceResizeAgent();
    });
    
    // Stop checking after 10 seconds, but keep resize function active
    setTimeout(function() {
        clearInterval(widgetChecker);
        // Continue forcing resize every 500ms
        setInterval(forceResizeAgent, 500);
    }, 10000);
    </script>
    <script type='text/javascript' src='https://storm-11c5bf736713cf.my.site.com/ESWSommalierGent1762152842517/assets/js/bootstrap.min.js' onload='initEmbeddedMessaging()'></script>
</body>
</html>
